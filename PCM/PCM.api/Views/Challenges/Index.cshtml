@model List<_999_Challenge>

@{
    ViewData["Title"] = "Giải Đấu";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Giải Đấu & Hội Thi</h2>
        @if (User.IsInRole("Admin"))
        {
            <a href="@Url.Action("Create")" class="btn btn-primary">+ Tạo Giải Đấu Mới</a>
        }
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-info">Chưa có giải đấu nào.</div>
    }
    else
    {
        <div class="row">
            @foreach (var challenge in Model)
            {
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title">@challenge.Title</h5>
                                <span class="badge bg-@(challenge.Status == "Open" ? "success" : challenge.Status == "Ongoing" ? "warning" : "secondary")">
                                    @challenge.Status
                                </span>
                            </div>
                            <p class="card-text small text-muted">@challenge.Description</p>
                            
                            <div class="mb-3">
                                <small class="d-block"><strong>Loại:</strong> @challenge.ChallengeType</small>
                                <small class="d-block"><strong>Định Dạng:</strong> @challenge.Format</small>
                                <small class="d-block"><strong>Người Tham Gia:</strong> @challenge.CurrentParticipants/@challenge.MaxParticipants</small>
                                @if (challenge.EntryFee > 0)
                                {
                                    <small class="d-block"><strong>Phí Dự Thi:</strong> @challenge.EntryFee.ToString("C0")</small>
                                }
                            </div>

                            <div class="progress mb-3" style="height: 20px;">
                                @{
                                    var percentage = challenge.MaxParticipants > 0 ? (challenge.CurrentParticipants * 100) / challenge.MaxParticipants : 0;
                                }
                                <div class="progress-bar" role="progressbar" style="width: @percentage%" aria-valuenow="@percentage" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>

                            <div class="d-flex gap-2">
                                <a href="@Url.Action("Details", new { id = challenge.Id })" class="btn btn-sm btn-outline-primary">Xem Chi Tiết</a>
                                @if (User.IsInRole("Admin"))
                                {
                                    <a href="@Url.Action("Edit", new { id = challenge.Id })" class="btn btn-sm btn-outline-secondary">Sửa</a>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>
